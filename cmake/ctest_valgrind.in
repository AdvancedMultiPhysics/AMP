# Sample script to run ctest and submit the results
SET ( CTEST_PROJECT_NAME "AMP" )
SET ( CTEST_SOURCE_DIRECTORY "../../../AMP-source" )
SET ( CTEST_BINARY_DIRECTORY "." )
SET ( CTEST_CMAKE_COMMAND "./HOSTNAME_cmake" )

SET ( CTEST_DASHBOARD "NightlyMemoryCheck" )
SET ( CTEST_BUILD_NAME "BBN" )
SET ( CTEST_TEST_TIMEOUT 1800 )
SET ( CTEST_CUSTOM_MAXIMUM_NUMBER_OF_ERRORS 500 )
SET ( CTEST_CUSTOM_MAXIMUM_NUMBER_OF_WARNINGS 500 )
SET ( NIGHTLY_START_TIME "18:00:00 EST" )
SET ( CTEST_NIGHTLY_START_TIME "22:00:00 EST" )
SET ( COVERAGE_COMMAND /usr/bin/gcov )

SET ( CTEST_COMMAND "\"${CTEST_EXECUTABLE_NAME}\" -D ${CTEST_DASHBOARD}" )
SET ( CTEST_CONFIGURE_COMMAND ${CTEST_CMAKE_COMMAND} )
SET ( CTEST_BUILD_COMMAND "make build-test -i -j6" )
SET ( CTEST_COVERAGE_COMMAND ${COVERAGE_COMMAND} )

# Clear the binary directory and create an initial cache
CTEST_EMPTY_BINARY_DIRECTORY (${CTEST_BINARY_DIRECTORY})
FILE(WRITE "${CTEST_BINARY_DIRECTORY}/CMakeCache.txt" "CTEST_TEST_CTEST:BOOL=1")

SET (VALGRIND_COMMAND "/usr/bin/valgrind")
#SET (VALGRIND_COMMAND_OPTIONS "--tool=memcheck --leak-check=yes --track-fds=yes --num-callers=50 --show-reachable=yes --track-origins=yes --malloc-fill=0xff --free-fill=0xfe --suppressions=AMP-SOURCE/ValgrindSuppresionFile")
SET (VALGRIND_COMMAND_OPTIONS  "--tool=memcheck --leak-check=yes --track-fds=yes --num-callers=50 --show-reachable=yes --suppressions=AMP-SOURCE/ValgrindSuppresionFile")
SET (MEMORYCHECK_COMMAND ${VALGRIND_COMMAND})
SET (MEMORYCHECKCOMMAND ${VALGRIND_COMMAND})
SET (CTEST_MEMORYCHECK_COMMAND ${VALGRIND_COMMAND})
SET (CTEST_MEMORYCHECKCOMMAND ${VALGRIND_COMMAND})
SET (CTEST_MEMORYCHECK_COMMAND_OPTIONS ${VALGRIND_COMMAND_OPTIONS})
SET (CTEST_MEMORYCHECKCOMMAND_OPTIONS  ${VALGRIND_COMMAND_OPTIONS})

SITE_NAME( CTEST_SITE )
CTEST_START("${CTEST_DASHBOARD}")
CTEST_UPDATE()
CTEST_CONFIGURE()
CTEST_BUILD()
CTEST_MEMCHECK( EXCLUDE procs   PARALLEL_LEVEL 7 )

SET ( CTEST_DROP_METHOD "http" )
SET ( CTEST_DROP_SITE "billmp1.ornl.gov" )
SET ( CTEST_DROP_LOCATION "/CDash/submit.php?project=AMP" )
SET ( CTEST_DROP_SITE_CDASH TRUE )
SET ( DROP_SITE_CDASH TRUE )
CTEST_SUBMIT()

SET ( CTEST_DROP_METHOD "http" )
SET ( CTEST_DROP_SITE "oblivion.engr.colostate.edu" )
SET ( CTEST_DROP_LOCATION "/CDash/submit.php?project=AMP" )
SET ( CTEST_DROP_SITE_CDASH TRUE )
SET ( CTEST_DROP_SITE_CDASH TRUE )
CTEST_SUBMIT()

