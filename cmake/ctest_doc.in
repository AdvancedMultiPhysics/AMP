# Sample script to run ctest and submit the results
# The following enviornmental variables are used:
#    AMP_SOURCE


SET ( CTEST_PROJECT_NAME "AMP" )
SET ( CTEST_SOURCE_DIRECTORY $ENV{AMP_SOURCE} )
SET ( CTEST_BINARY_DIRECTORY "." )
SET ( CTEST_CMAKE_COMMAND "cmake -D ONLY_BUILD_DOCS=1 ${CTEST_SOURCE_DIRECTORY}" )

SET ( CTEST_DASHBOARD "Nightly" )
SET ( CTEST_BUILD_NAME "AMP-docs" )
SET ( CTEST_TEST_TIMEOUT 300 )
SET ( CTEST_CUSTOM_MAXIMUM_NUMBER_OF_ERRORS 500 )
SET ( CTEST_CUSTOM_MAXIMUM_NUMBER_OF_WARNINGS 500 )
SET ( CTEST_CUSTOM_MAXIMUM_PASSED_TEST_OUTPUT_SIZE "10000" )
SET ( CTEST_CUSTOM_MAXIMUM_FAILED_TEST_OUTPUT_SIZE "20000" )
SET ( NIGHTLY_START_TIME "18:00:00 EST" )
SET ( CTEST_NIGHTLY_START_TIME "22:00:00 EST" )
SET ( COVERAGE_COMMAND /usr/bin/gcov )

SET ( CTEST_COMMAND "\"${CTEST_EXECUTABLE_NAME}\" -D ${CTEST_DASHBOARD}" )
SET ( CTEST_CONFIGURE_COMMAND ${CTEST_CMAKE_COMMAND} )
SET ( CTEST_BUILD_COMMAND "make doc -j 4 -i" )
SET ( CTEST_COVERAGE_COMMAND ${COVERAGE_COMMAND} )

# Clear the binary directory and create an initial cache
CTEST_EMPTY_BINARY_DIRECTORY (${CTEST_BINARY_DIRECTORY})
FILE(WRITE "${CTEST_BINARY_DIRECTORY}/CMakeCache.txt" "CTEST_TEST_CTEST:BOOL=1")

# Configure and run the tests
SITE_NAME( CTEST_SITE )
CTEST_START("${CTEST_DASHBOARD}")
CTEST_UPDATE()
CTEST_CONFIGURE()
CTEST_BUILD()

# Submit the results to billmp1
SET ( CTEST_DROP_METHOD "http" )
SET ( CTEST_DROP_SITE "billmp1.ornl.gov" )
SET ( CTEST_DROP_LOCATION "/CDash/submit.php?project=AMP" )
SET ( CTEST_DROP_SITE_CDASH TRUE )
SET ( DROP_SITE_CDASH TRUE )
CTEST_SUBMIT()

# Submit the results to oblivion
SET ( CTEST_DROP_METHOD "http" )
SET ( CTEST_DROP_SITE "oblivion.engr.colostate.edu" )
SET ( CTEST_DROP_LOCATION "/CDash/submit.php?project=AMP" )
SET ( CTEST_DROP_SITE_CDASH TRUE )
SET ( CTEST_DROP_SITE_CDASH TRUE )
CTEST_SUBMIT()

