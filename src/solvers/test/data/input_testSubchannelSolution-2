// Input file for testSubchannelSolution
TOLERANCE = 2e-3
Inlet_Pressure = 15.59e6   // Solution inlet pressure

Mesh {
     MeshName = "subchannel"
     MeshType = "AMP"
     dim = 3
     Generator = "cube"
     Size = 1, 1, 15
     Range = 0.0, 1.28016e-2, 0.0, 1.28016e-2, 0.0, 3.81 
     x_offset = 0.0
     y_offset = 0.0
     z_offset = 0.0
}

SubchannelTwoEqNonlinearOperator{
    name = "SubchannelTwoEqNonlinearOperator"
    InputVariable = "flow"
    OutputVariable = "flow"
    Exit_Pressure = 15.5132e6           // Pa
    Inlet_Temperature = 569.26          // K
    Mass_Flow_Rate = 0.3522             // kg/s
    Fission_Heating_Coefficient = 0.0
    Channel_Angle = 0.0
    Friction_Factor = 0.001
    Lattice_Pitch = 0.0128016
    Rod_Diameter = 0.0097028
    Rod_Power = 66.81e3
    Heat_Source_Type = "totalHeatGeneration"
    Channel_Diameter = 0.01178  // Todreas, p.455
    Reynolds         = 95432.91 // Todreas, p.456, based on viscosity=8.69e-5; velocity=1 m/s; density=704; & Channel_Diameter
    Prandtl          = 1.0      // Todreas, p.455, based on viscosity=8.69e-5; Conductivity; & Heat_Capacity 
    Heat_Shape = "Sinusoidal"
    LocalModel = "SubchannelPhysicsModel"
    Friction_Model = "Constant"
    Number_GridSpacers = 15
    zMin_GridSpacers = 0.0, 0.254, 0.508, 0.762, 1.016, 1.270, 1.524, 1.778, 2.032, 2.286, 2.540, 2.794, 3.048, 3.302, 3.556
    zMax_GridSpacers = 0.254, 0.508, 0.762, 1.016, 1.270, 1.524, 1.778, 2.032, 2.286, 2.540, 2.794, 3.048, 3.302, 3.556, 3.810
    LossCoefficient_GridSpacers = 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2
}

SubchannelTwoEqLinearOperator{
    name = "SubchannelTwoEqLinearOperator"
    InputVariable = "flow"
    OutputVariable = "flow"
    Exit_Pressure = 15.5132e6
    Inlet_Temperature = 569.26
    Mass_Flow_Rate = 0.3522
    Fission_Heating_Coefficient = 0.0
    Channel_Angle = 0.0
    Friction_Factor = 0.001
    Lattice_Pitch = 0.0128016
    Rod_Diameter = 0.0097028
    Form_Loss_Coefficient = 0.2
    Rod_Power = 66.81e3
    Heat_Source_Type = "totalHeatGeneration"
    Channel_Diameter = 0.01178  // Todreas, p.455
    Reynolds         = 95432.91 // Todreas, p.456, based on viscosity=8.69e-5; velocity=1 m/s; density=704; & Channel_Diameter
    Prandtl          = 1.0      // Todreas, p.455, based on viscosity=8.69e-5; Conductivity; & Heat_Capacity 
    Heat_Shape = "Sinusoidal"
    LocalModel = "SubchannelPhysicsModel"
}

SubchannelPhysicsModel{
	name = "SubchannelPhysicsModel"
	Material = "WaterLibrary"
	Formulation = "FunctionsTesting"
	Defaults{
        diameter    = 0.01178  // Todreas, p.455
		temperature = 350.0
		enthalpy    = 200.0e3
		pressure    = 0.5e6
		density     = 973.919
        reynolds    = 95432.91 // Todreas, p.456, based on viscosity=8.69e-5; velocity=1 m/s; density=704; & Channel_Diameter
        prandtl     = 1.0      // Todreas, p.455, based on viscosity=8.69e-5; Conductivity; & Heat_Capacity 
	}
}

NonlinearSolver{
  print_info_level = 7
    max_iterations = 1000
    max_error = 1e-10

    absoluteTolerance = 1.0e-6
    relativeTolerance = 1.0e-5
    stepTolerance = 1.0e-10
    maximumFunctionEvals = 1000
    usesJacobian=FALSE

    SNESOptions = "-snes_monitor -snes_type ls -snes_converged_reason -snes_ksp_ew -snes_ksp_ew_version 1 -snes_ls_alpha 0.01"

    LinearSolver{
      print_info_level = 10
        max_iterations = 1000
        max_error = 1e-7
        ksp_type = "fgmres"
        absolute_tolerance = 1.0e-7
        relative_tolerance = 1.0e-1
        divergence_tolerance = 1.0e03
        max_krylov_dimension = 40
        uses_preconditioner=FALSE
        pc_type = "none"
        pc_side = "RIGHT"

        KSPOptions = "-ksp_monitor -ksp_converged_reason -ksp_max_it 1000"
        Preconditioner{
          print_info_level = 1
            max_iterations = 1
            max_error = 1.0e-7
        }
    }
}
